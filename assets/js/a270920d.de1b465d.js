"use strict";(self.webpackChunkneutron=self.webpackChunkneutron||[]).push([[1054],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},d="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(n),m=a,h=d["".concat(l,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(h,s(s({ref:t},u),{},{components:n})):r.createElement(h,s({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:a,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9548:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var r=n(7462),a=(n(7294),n(3905));const o={},s="Overview",i={unversionedId:"neutron/modules/contract-manager/overview",id:"neutron/modules/contract-manager/overview",title:"Overview",description:"Abstract",source:"@site/docs/neutron/modules/contract-manager/overview.md",sourceDirName:"neutron/modules/contract-manager",slug:"/neutron/modules/contract-manager/overview",permalink:"/neutron/modules/contract-manager/overview",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Messages",permalink:"/neutron/modules/transfer/messages"},next:{title:"Client",permalink:"/neutron/modules/contract-manager/client"}},l={},c=[{value:"Abstract",id:"abstract",level:2},{value:"Concepts",id:"concepts",level:2},{value:"Gas limitation",id:"gas-limitation",level:3},{value:"Binding msgs",id:"binding-msgs",level:2},{value:"ResubmitFailure",id:"resubmitfailure",level:3},{value:"Binding queries",id:"binding-queries",level:2}],u={toc:c},d="wrapper";function p(e){let{components:t,...n}=e;return(0,a.kt)(d,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"overview"},"Overview"),(0,a.kt)("h2",{id:"abstract"},"Abstract"),(0,a.kt)("p",null,"This document specifies the ContractManager module for the Neutron network."),(0,a.kt)("p",null,"The ContractManager module implements a mechanism and contains methods to make sudo calls to the contracts as well it helps to store sudo handler calls errors during IBC ACK."),(0,a.kt)("h2",{id:"concepts"},"Concepts"),(0,a.kt)("p",null,"Due to the fact that contracts are allowed to make calls to the IBC, as well as process all received data, a problem arises in which a malicious contract can make a call to the IBC and, during the response of the ACK, make an error in the sudo handler, or simply do not implement it. Which will lead to disruption of the channel (in the case of a ORDERED channel), or force the relayer to send ACK requests over and over again, thereby loading the nodes serving the blockchain."),(0,a.kt)("p",null,"In order to avoid this problem, the code in the module from which the sudo handler is called should ignore the error and instead return the success status of the call.\nBut this in turn exposes the problem of informing the owner of the contract that a failure has occurred. To do this, in case of an unsuccessful call, the module from which the sudo handler is called must call the ",(0,a.kt)("inlineCode",{parentName:"p"},"AddContractFailure")," method of the ",(0,a.kt)("inlineCode",{parentName:"p"},"keeper")," of the ",(0,a.kt)("inlineCode",{parentName:"p"},"ContractManager")," module."),(0,a.kt)("p",null,"To ensure that the state of the contract is consistent, the call to the sudo handler takes place in a temporary state (using ",(0,a.kt)("inlineCode",{parentName:"p"},"CacheContext"),"), which is written to the active state if the call succeeds."),(0,a.kt)("h3",{id:"gas-limitation"},"Gas limitation"),(0,a.kt)("p",null,"To make sure there are no exploits with infinite recursion of IBC messages which call other IBC messages in sudo handler we use constant gas ",(0,a.kt)("inlineCode",{parentName:"p"},"LIMIT")," to spend. The LIMIT is small, so you can't place extensive work in Sudo handlers. As a workaround, in such cases you can use Sudo handlers to simply store required payload in contract's state, and use Execute messages to handle results separately."),(0,a.kt)("p",null,"If your contract exceeds this constant ",(0,a.kt)("inlineCode",{parentName:"p"},"LIMIT"),", it will terminate sudo handler call and save a ",(0,a.kt)("inlineCode",{parentName:"p"},"Failure")," with full call info. You can ",(0,a.kt)("a",{parentName:"p",href:"#resubmitfailure"},"resubmit failure")," from this contract."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"LIMIT")," is defined by ",(0,a.kt)("inlineCode",{parentName:"p"},"SudoCallGasLimit")," module's parameter."),(0,a.kt)("p",null,"We provide an ability to resubmit bindings through the contract that initiated the IBC transaction."),(0,a.kt)("h2",{id:"binding-msgs"},"Binding msgs"),(0,a.kt)("h3",{id:"resubmitfailure"},"ResubmitFailure"),(0,a.kt)("p",null,"Cosmwasm contracts that sent an IBC transfer or ICA transaction can resubmit their failures."),(0,a.kt)("p",null,"This binding is permissioned - only the contract that sent an IBC transfer or transaction can call it."),(0,a.kt)("p",null,"The format is as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'type ResubmitFailure struct {\n    FailureId uint64 `json:"failure_id"`\n}\n')),(0,a.kt)("p",null,"Binding in cosmwasm described ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/neutron-org/neutron-sdk/blob/feat/contract-manager-resubmit/packages/neutron-sdk/src/bindings/msg.rs#L184"},"here"),"."),(0,a.kt)("p",null,"It will call sudo handler with exact same arguments as the original handler that failed.\nThe only difference is that this ",(0,a.kt)("inlineCode",{parentName:"p"},"SubmitHandler")," will be called not from relayer, so the gas limitations above do not apply."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Note that you can only resubmit failure through cosmwasm contract.")),(0,a.kt)("p",null,"See examples on how to resubmit failure for ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/neutron-org/neutron-dev-contracts/blob/feat/contract-manager-resubmit/contracts/neutron_interchain_txs/src/contract.rs#L441"},"interchain txs")," and for ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/neutron-org/neutron-dev-contracts/blob/feat/contract-manager-resubmit/contracts/ibc_transfer/src/contract.rs#L271"},"ibc transfer")),(0,a.kt)("h2",{id:"binding-queries"},"Binding queries"),(0,a.kt)("p",null,"Failures for contract address can be queried using ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/neutron-org/neutron/blob/feat/contract-manager-resubmit/wasmbinding/bindings/query.go#L39"},"bindings"),"."),(0,a.kt)("p",null,"Query request struct should be like:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'type Failures struct {\n    Address    string             `json:"address"`\n    Pagination *query.PageRequest `json:"pagination,omitempty"`\n}\n')),(0,a.kt)("p",null,"Response:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'type FailuresResponse struct {\n    Failures []contractmanagertypes.Failure `json:"failures"`\n}\n')),(0,a.kt)("p",null,"You're encouraged to use our neutron-sdk implementation in contracts - ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/neutron-org/neutron-sdk/blob/feat/contract-manager-resubmit/packages/neutron-sdk/src/bindings/query.rs#L61"},"request")," and ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/neutron-org/neutron-sdk/blob/feat/contract-manager-resubmit/packages/neutron-sdk/src/bindings/query.rs#L119"},"response")))}p.isMDXComponent=!0}}]);